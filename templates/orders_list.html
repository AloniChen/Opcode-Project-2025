<!doctype html>
<html class="no-js" lang="">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>orders list</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Prefer url_for for all static assets -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap-theme.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/fontAwesome.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/templatemo-style.css') }}">

    <link href="https://fonts.googleapis.com/css?family=Montserrat:100,200,300,400,500,600,700,800,900" rel="stylesheet">
    <script src="{{ url_for('static', filename='js/vendor/modernizr-2.8.3-respond-1.4.2.min.js') }}"></script>

    <style>
      .custom-table .label { display: inline-block; padding: 4px 8px; border-radius: 4px; }
      .label-success { background:#5cb85c; color:#fff; }
      .label-danger  { background:#d9534f; color:#fff; }
      .label-info    { background:#5bc0de; color:#fff; }
      .label-warning { background:#f0ad4e; color:#fff; }
      .label-default { background:#777;   color:#fff; }
      .cd-hero .heading { text-align:center; margin-top: 20px; }
      .table-responsive { margin-top: 24px; }
      tr[onclick] { cursor: pointer; }
    </style>
  </head>
  <body>
    <div class="overlay"></div>

    <section class="cd-hero">
      <div class="cd-slider-nav">
        <nav>
          <span class="cd-marker item-1"></span>
          <ul>
            <li class="selected">
              <a href="{{ url_for('show_all_orders',  user_type=session.get('user_type')) }}"><div class="image-icon"><img src="{{ url_for('static', filename='img/home-icon.png') }}" alt=""></div><h6><br>HOME</h6></a>
            </li>
            {% if session.get('user_type') == 'customers' %}
            <li>
              <a href="{{ url_for('create_new_order',  user_type=session.get('user_type')) }}"><div class="image-icon"><img src="{{ url_for('static', filename='img/plus_icon.png') }}" alt=""></div><h6>Create<br>New order</h6></a>
            </li>
            {% endif %}
            {% if session.get('user_type') == 'managers' %}
            <li>
              <a href="{{ url_for('dashboard', user_type=session.get('user_type')) }}"><div class="image-icon"> <img src="{{ url_for('static', filename='img/chart-icon.png') }}" alt="Dashboard Icon"></div><h6><br>DASHBOARD</h6></a>
            </li>
            <li><a href=""><div class="image-icon"><img src="../static/img/about-icon.png"></div><h6>Add<br>Courier</h6></a></li>
            {% endif %}
            <li><a href="{{ url_for('logout') }}"><div class="image-icon"><img src="../static/img/about-icon.png"></div><h6><br>Log Out</h6></a></li>
          </ul>
        </nav>
      </div>

      <ul class="cd-hero-slider">
        <li class="selected">
          <div class="heading">
            <h1>DeliverySim</h1>
            <span>Welcome to DeliverySim</span>
          </div>
          <div class="cd-full-width first-slide">
            <div class="container">
              <div class="row">
                <div class="col-lg-12">
                  <div class="content first-content">
                        <div class="contact-form">
                          <h4>Orders List</h4>
                            <span>Manage your orders efficiently</span>
                            {% with messages = get_flashed_messages() %}
                              {% if messages %}
                                  <div class="flash-message">
                                  {{ messages[0] }}
                                  </div>
                              {% endif %}
                            {% endwith %}
                        </div>
                  </div>
                </div>
                <div class="col-md-12">
                  <div class="content first-content">

                    <div class="table-responsive mt-5">
                      <table class="table table-bordered table-hover text-center align-middle custom-table">
                        <thead class="thead-dark">
                          <tr>
                            <th>Package ID</th>
                            <th>Customer ID</th>
                            <th>Courier ID</th>
                            <th>Origin</th>
                            <th>Destination</th>
                            <th>Status</th>
                          </tr>
                        </thead>
                        <tbody>
                          {% for order in orders %}
                            {# Normalize status for row #}
                            {% set raw_status = (order.status.value if not (order.status is string) else order.status) %}
                            {% set s = (raw_status|string)|lower %}
                            {% set status = 'confirmed - assigned to courier' if s == 'confirmed' else s %}

                            <form action="/order_details" method="post" id="form-{{ order.package_id }}">
                              <input type="hidden" name="package_id" value="{{ order.package_id }}">
                              <input type="hidden" name="customer_id" value="{{ order.customer_id }}">
                              <input type="hidden" name="courier_id" value="{{ order.courier_id }}">
                              <input type="hidden" name="origin_address_str" value="{{ order.origin_address_str }}">
                              <input type="hidden" name="destination_address_str" value="{{ order.destination_address_str }}">
                              <input type="hidden" name="status" value="{{ status }}">
                            </form>

                            <tr onclick="window.location.href='{{ url_for('order_details_get', package_id=order.package_id) }}'">

                              <td>{{ order.package_id }}</td>
                              <td>{{ order.customer_id }}</td>
                              <td>{{ order.courier_id }}</td>
                              <td>{{ order.origin_address_str }}</td>
                              <td>{{ order.destination_address_str }}</td>
                              <td>
                                <span class="label
                                  {% if status == 'delivered' %}label-success
                                  {% elif status == 'canceled' %}label-danger
                                  {% elif status == 'on-delivery' %}label-info
                                  {% elif status == 'confirmed - assigned to courier' %}label-warning
                                  {% elif status == 'no assigned courier' %}label-default
                                  {% else %}label-default{% endif %}">
                                  {{ status }}
                                </span>
                              </td>
                            </tr>
                          {% endfor %}
                        </tbody>
                      </table>
                    </div>

                  </div>
                </div>
              </div>
            </div>
          </div>
        </li>
      </ul>
    </section>

    <footer>
      <p>Copyright &copy; 2020 Your Company | Designed by <em>Template Mo</em></p>
    </footer>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="{{ url_for("static", filename="js/vendor/jquery-1.11.2.min.js") }}"><\/script>')</script>
    <script src="{{ url_for('static', filename='js/vendor/bootstrap.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/plugins.js') }}"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
  </body>
</html>
